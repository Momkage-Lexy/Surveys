<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Survey Options with Particles</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Electrolize&family=Funnel+Display:wght@300..800&display=swap" rel="stylesheet">
    <style>
        html, body {
            margin: 0;
            height: 100%;
            overflow: hidden;
            background-color: #111;
            font-family: "Funnel Display", sans-serif;
        }

        #particleCanvas {
            position: fixed;
            inset: 0;
            z-index: 0;
        }

        .frosted-glass{
            position: relative;
            z-index: 1;
            height: 600px;
            width: 800px;
            background: radial-gradient(farthest-corner at 37% 0%, #d73f09ff 0%, #d7400952 40%, #ffffff00 58%), 
                        radial-gradient(farthest-corner at 53% 0%, #f7a162ff 0%, #f8a16399 10%, #ffffff00 48%), 
                        linear-gradient(to top, #ffffff10 100%, #ffffff10 100%);
            box-shadow: 0 4px 30px rgb(0, 0, 0);
            backdrop-filter: blur(10.9px);
            -webkit-backdrop-filter: blur(10.9px);
            margin:auto;
            margin-top:100px;
        }

        .frosted-glass h1{
            color: #ffffff30;
            font-family: "Funnel Display", sans-serif;
            font-weight: 900;
            font-size: 1.25rem;
            margin-bottom: 0;
            rotate: -90deg;
            position: absolute;
            top: 40px;
        }
        
        .frosted-glass .welcome-text h2{
            color: white;
            font-family: "Funnel Display", sans-serif;
            font-weight: 300;
            font-size: 3rem;
            margin-top: 0;
            border-left: 1px solid #fff;
            padding-left: 1rem;
            position: absolute;
            left: 70px;
        }

        .frosted-glass .form-label{
            color: white;
            position: absolute;
            top: 250px;
            left: 229px;
            font-family: "Funnel Display", sans-serif;
            font-size: 1rem;
        }

        .frosted-glass .form-label h2{
            font-weight: 100;
        }

        .white-line{
            position: absolute;
            top: 310px;
            left: 229px;
            width: 345px;
            border-bottom: 1px solid white;
        }

        .frosted-glass form{
            position: relative;
        }

        .input-text-box{
            border-radius: 50px;
            background-color: #ffffff09;
            border: 1px solid rgba(255, 255, 255, 0.384);
            color: white;
            position: absolute;
            top: 325px;
            left: 229px;
            padding: 10px;
            width: 325px;
        }

        .input-text-box::placeholder{
            color:white;
        }

        .frosted-glass form .submit-btn{
            color: white;
            background-color: #d73f09;
            position: absolute;
            top: 325px;
            left: 526px;
            padding: 0.12rem;
            border-radius: 0 50px 50px 0;
            border: 1px solid rgba(255, 255, 255, 0.384);
            width: 50px;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .hide {
            display: none !important;
        }

        .wheel-wrapper {
            position: relative;
            width: 600px;
            height: 600px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-radius: 50%;
        }

        .spin-button {
            position: absolute;
            width: 100px;
            height: 100px;
            background: #fff;
            border-radius: 50%;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            text-transform: uppercase;
            font-weight: 700;
            font-size: 14px;
            color: #333;
            border: 5px solid #333;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .spin-button:hover:not(.spinning) {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .spin-button:active:not(.spinning) {
            transform: scale(0.95);
        }

        .spin-button.spinning {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .spin-button::before {
            content: '';
            position: absolute;
            top: -35px;
            width: 25px;
            height: 35px;
            background: #333;
            clip-path: polygon(50% 0%, 15% 100%, 85% 100%);
        }

        .wheel {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #333;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 0 8px #333, 0 0 0 18px #fff, 0 0 0 22px #333;
            transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }

        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: bottom right;
            transform: rotate(calc(45deg * var(--i)));
            clip-path: polygon(0 0, 60% 0, 100% 100%, 0 60%);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .wheel-segment span {
            position: relative;
            transform: rotate(45deg);
            color: #fff;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        #spinnerWheel, #spinnerWheel2 {
            opacity: 0;
            transition: opacity 0.8s ease;
            display: grid;
            place-items: center;
            height: 100%;
        }

        #spinnerWheel.show, #spinnerWheel2.show {
            opacity: 1;
        }

        .fade-out {
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-backdrop.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 450px;
            animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .prize-display {
            font-size: 90px;
            font-weight: 700;
            color: #d73f09;
            margin: 30px 0;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.1);
            animation: bounce 0.6s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 14px 35px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn.primary {
            background: #d73f09;
            color: white;
        }

        .modal-btn.primary:hover {
            background: white;
            color:#000;
            border: 1px solid #000;
            transform: translateY(-2px);
        }

        .modal-btn.secondary {
            background: #f0f0f0;
            color: #333;
        }

        .modal-btn.secondary:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .flex{
            display:flex;
        }
    </style>
</head>
<body>

<canvas id="particleCanvas"></canvas>

<div class="frosted-glass">
    <div class="welcome-text flex">
        <h1>AGU 2025</h1>
        <h2>Oregon State<br>University</h2>
    </div>
    <div class="form-label">
        <h2 id="questionLabel">Enter Your Name</h2>
    </div>

    <div class="white-line"></div>

    <form id="questionForm">
        <input type="text" id="questionInput" placeholder="Type here..." class="input-text-box">
        <button type="submit" class="submit-btn">ðŸ¡ª</button>
    </form>
</div>

<div id="spinnerWheel" class="hide">
    <div class="wheel-wrapper">
        <div class="spin-button" id="spinBtn">SPIN</div>
        <div class="wheel" id="wheelElement">
            <div class="wheel-segment" style="--i:1; background:#d73f09;"><span>100</span></div>
            <div class="wheel-segment" style="--i:2; background:#4A773C;"><span>50</span></div>
            <div class="wheel-segment" style="--i:3; background:#003B5C;"><span>25</span></div>
            <div class="wheel-segment" style="--i:4; background:#f7a162;"><span>75</span></div>
            <div class="wheel-segment" style="--i:5; background:#d73f09;"><span>100</span></div>
            <div class="wheel-segment" style="--i:6; background:#0D5257;"><span>50</span></div>
            <div class="wheel-segment" style="--i:7; background:#D3832B;"><span>25</span></div>
            <div class="wheel-segment" style="--i:8; background:#4A773C;"><span>6</span></div>
        </div>
    </div>
</div>

<div id="spinnerWheel2" class="hide">
    <div class="wheel-wrapper">
        <div class="spin-button" id="spinBtn2">SPIN</div>
        <div class="wheel" id="wheelElement2">
            <div class="wheel-segment" style="--i:1; background:#d73f09;"><span>1</span></div>
            <div class="wheel-segment" style="--i:2; background:#4A773C;"><span>2</span></div>
            <div class="wheel-segment" style="--i:3; background:#003B5C;"><span>3</span></div>
            <div class="wheel-segment" style="--i:4; background:#f7a162;"><span>4</span></div>
            <div class="wheel-segment" style="--i:5; background:#d73f09;"><span>5</span></div>
            <div class="wheel-segment" style="--i:6; background:#0D5257;"><span>6</span></div>
            <div class="wheel-segment" style="--i:7; background:#D3832B;"><span>7</span></div>
            <div class="wheel-segment" style="--i:8; background:#4A773C;"><span>8</span></div>
        </div>
    </div>
</div>

<div class="modal-backdrop" id="prizeModal">
    <div class="modal-content">
        <h2>Congratulations!</h2>
        <div class="prize-display" id="prizeValue">100</div>
        <p>You won <strong id="prizeLabel">100 points</strong>!</p>
        <div class="modal-buttons">
            <button class="modal-btn primary" id="spinAgain">Spin Again</button>
            <button class="modal-btn secondary" id="closeModal">Close</button>
        </div>
    </div>
</div>

<script>
const canvas = document.getElementById("particleCanvas");
const ctx = canvas.getContext("2d");

let particles = [];
const BASE_PARTICLES = 1000;
let particleMode = "drift"; // "drift", "shrinking", "bursting"
let centerX = window.innerWidth / 2;
let centerY = window.innerHeight / 2;

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    centerX = canvas.width / 2;
    centerY = canvas.height / 2;
    if (particleMode === "drift") {
        addBaseParticles();
    }
}
resize();
window.addEventListener("resize", resize);

function addBaseParticles() {
    particles = [];
    for (let i = 0; i < BASE_PARTICLES; i++) {
        particles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            vx: (Math.random() - .5) * .3,
            vy: (Math.random() - .5) * .3,
            size: Math.random()*2 + 1,
            color: "rgba(255,255,255,0.6)",
            isWhite: true
        });
    }
}
addBaseParticles();

function explodeToParticles(x, y) {
    for (let i = 0; i < 25; i++) {
        particles.push({
            x,
            y,
            vx: (Math.random() - .5) * 6,
            vy: (Math.random() - .5) * 6,
            size: Math.random()*4 + 2,
            color: "#d73f09",
            isWhite: false
        });
    }
}

function shrinkParticlesToCenter() {
    particleMode = "shrinking";
    
    // Give each particle a random delay and trajectory (reverse of burst)
    particles.forEach((p, index) => {
        // Random delay for each particle (0-800ms)
        const delay = Math.random() * 800;
        
        // Store when this particle should start shrinking
        p.shrinkDelay = Date.now() + delay;
        p.shrinking = false;
        
        // Calculate target point near center
        const targetRadius = Math.random() * 50;
        const targetAngle = Math.random() * Math.PI * 2;
        p.targetX = centerX + Math.cos(targetAngle) * targetRadius;
        p.targetY = centerY + Math.sin(targetAngle) * targetRadius;
    });
}

function burstParticlesFromCenter(whiteOnly = false) {
    particleMode = "bursting";
    
    // Filter and reset particles
    if (whiteOnly) {
        particles = particles.filter(p => p.isWhite);
    }
    
    // Stagger the burst - particles spray out at different times like water droplets
    particles.forEach((p, index) => {
        // Random delay for each particle (0-800ms)
        const delay = Math.random() * 800;
        
        setTimeout(() => {
            // Random starting position near center (not all exactly at center)
            const startRadius = Math.random() * 50;
            const startAngle = Math.random() * Math.PI * 2;
            p.x = centerX + Math.cos(startAngle) * startRadius;
            p.y = centerY + Math.sin(startAngle) * startRadius;
            
            // Very random velocities - some fast, some slow, all directions
            const angle = Math.random() * Math.PI * 2;
            const speed = 2 + Math.random() * 8; // Wide speed range
            
            // Add some chaos to the angle
            const chaosX = (Math.random() - 0.5) * 3;
            const chaosY = (Math.random() - 0.5) * 3;
            
            p.vx = Math.cos(angle) * speed + chaosX;
            p.vy = Math.sin(angle) * speed + chaosY;
            
            // Random initial opacity
            p.burstOpacity = 0;
            p.burstFadeIn = true;
        }, delay);
    });
    
    // Return to drift mode after all bursts complete
    setTimeout(() => {
        particleMode = "drift";
        particles.forEach(p => {
            p.burstOpacity = undefined;
            p.burstFadeIn = undefined;
        });
    }, 2000);
}

function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    particles.forEach((p, index) => {
        if (particleMode === "drift") {
            // Normal drifting
            p.x += p.vx;
            p.y += p.vy;

            if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
            if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
        } 
        else if (particleMode === "shrinking") {
            // Check if this particle should start shrinking yet
            if (Date.now() >= p.shrinkDelay && !p.shrinking) {
                p.shrinking = true;
            }
            
            if (p.shrinking) {
                // Move toward target point near center
                let dx = p.targetX - p.x;
                let dy = p.targetY - p.y;
                let dist = Math.sqrt(dx * dx + dy * dy);
                
                // Accelerate toward center (reverse of slowing down)
                const speed = 0.12;
                p.x += dx * speed;
                p.y += dy * speed;
                
                // Fade out as approaching center
                if (dist < 150) {
                    const alpha = dist / 150;
                    if (p.isWhite) {
                        p.color = `rgba(255,255,255,${0.6 * alpha})`;
                    } else {
                        p.color = `rgba(215,63,9,${alpha})`;
                    }
                }
            } else {
                // Keep drifting until shrink delay triggers
                p.x += p.vx * 0.3;
                p.y += p.vy * 0.3;
                
                if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
            }
        }
        else if (particleMode === "bursting") {
            // Burst outward with varied timing
            if (p.burstFadeIn !== undefined) {
                // Fade in as particle bursts
                if (p.burstOpacity < 1) {
                    p.burstOpacity += 0.05;
                }
                
                p.x += p.vx;
                p.y += p.vy;
                
                // Apply some gravity and air resistance
                p.vx *= 0.985;
                p.vy *= 0.985;
                p.vy += 0.02; // slight downward pull
                
                // Dynamic opacity based on burst progress
                const alpha = Math.min(p.burstOpacity, 0.6);
                if (p.isWhite) {
                    p.color = `rgba(255,255,255,${alpha})`;
                } else {
                    p.color = `rgba(215,63,9,${alpha})`;
                }
            } else {
                // Particle hasn't started bursting yet, keep it invisible at center
                p.x = centerX;
                p.y = centerY;
                p.color = "rgba(255,255,255,0)";
            }
        }

        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
    });

    requestAnimationFrame(animate);
}
animate();

/* QUESTION FLOW */
let round = 1;

const round1Questions = [
    { label: "Enter your name", placeholder: "Name" },
    { label: "Organization", placeholder: "Organization" }
];

const round2Questions = [
    { label: "Favorite Color", placeholder: "Favorite color" },
    { label: "Favorite Animal", placeholder: "Favorite animal" }
];

let questions = round1Questions;
let qIndex = 0;

const answers = {
    name: "",
    org: "",
    color: "",
    animal: ""
};

let lastPrize = 0;

const questionLabel = document.getElementById("questionLabel");
const questionInput = document.getElementById("questionInput");
const questionForm = document.getElementById("questionForm");

function loadQuestion() {
    const q = questions[qIndex];
    questionLabel.textContent = q.label;
    questionInput.placeholder = q.placeholder;
    questionInput.value = "";
    questionInput.focus();
}

questionForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const value = questionInput.value.trim();
    if (!value) return;
    
    if (round === 1) {
        if (qIndex === 0) answers.name = value;
        else if (qIndex === 1) answers.org = value;
    } else if (round === 2) {
        if (qIndex === 0) answers.color = value;
        else if (qIndex === 1) answers.animal = value;
    }
    
    const rect = questionForm.getBoundingClientRect();
    explodeToParticles(rect.left + rect.width / 2, rect.top + rect.height / 2);

    qIndex++;

    if (qIndex < questions.length) {
        loadQuestion();
        return;
    }

    finishedQuestions();
});

function finishedQuestions() {
    const glass = document.querySelector(".frosted-glass");

    // Start shrinking particles
    shrinkParticlesToCenter();

    setTimeout(() => {
        glass.classList.add("hide");
        canvas.style.display = "none";
        document.body.style.background = "black";

        if (round === 1) {
            spinnerWheel.classList.remove("hide");
            setTimeout(() => spinnerWheel.classList.add("show"), 50);
        } else {
            spinnerWheel2.classList.remove("hide");
            setTimeout(() => spinnerWheel2.classList.add("show"), 50);
        }
    }, 800);
}

loadQuestion();

/* SPINNER LOGIC */
const wheel = document.getElementById("wheelElement");
const spinBtn = document.getElementById("spinBtn");
let rotation = 0;
let isSpinning = false;
let prizes = [100, 50, 25, 75, 100, 50, 25, 6];
let prizes2 = [1, 2, 3, 4, 5, 6, 7, 8];

spinBtn.addEventListener("click", () => {
    if (isSpinning) return;
    isSpinning = true;
    spinBtn.classList.add("spinning");

    const spins = 5 + Math.floor(Math.random() * 3);
    const extra = Math.floor(Math.random() * 360);
    const total = (spins * 360) + extra;

    rotation += total;
    wheel.style.transform = `rotate(${rotation}deg)`;

    setTimeout(() => {
        const normalized = rotation % 360;
        const angle = (360 - normalized + 22.5) % 360;
        const segment = Math.floor(angle / 45);
        const prize = prizes[segment];

        showPrizeModal(prize);
        isSpinning = false;
        spinBtn.classList.remove("spinning");
    }, 5000);
});

const wheel2 = document.getElementById("wheelElement2");
const spinBtn2 = document.getElementById("spinBtn2");
let rotation2 = 0;
let isSpinning2 = false;

spinBtn2.addEventListener("click", () => {
    if (isSpinning2) return;
    isSpinning2 = true;
    spinBtn2.classList.add("spinning");

    const spins = 5 + Math.floor(Math.random() * 3);
    const extra = Math.floor(Math.random() * 360);
    const total = (spins * 360) + extra;

    rotation2 += total;
    wheel2.style.transform = `rotate(${rotation2}deg)`;

    setTimeout(() => {
        const normalized = rotation2 % 360;
        const angle = (360 - normalized + 22.5) % 360;
        const segment = Math.floor(angle / 45);
        const prize = prizes2[segment];

        showPrizeModal(prize);
        isSpinning2 = false;
        spinBtn2.classList.remove("spinning");
    }, 5000);
});

/* MODAL + ROUND TRANSITIONS */
function showPrizeModal(prize) {
    lastPrize = prize;
    document.getElementById("prizeValue").textContent = prize;
    document.getElementById("prizeLabel").textContent = `${prize} points`;

    if (round === 1) {
        document.getElementById("spinAgain").style.display = "inline-block";
    }

    if (round === 2) {
        document.getElementById("spinAgain").style.display = "none";
    }

    document.getElementById("prizeModal").classList.add("active");
}

const prizeModal = document.getElementById("prizeModal");
const spinnerWheel = document.getElementById("spinnerWheel");

document.getElementById("closeModal").addEventListener("click", () => {
    if (round === 2 && window.chrome && window.chrome.webview) {
        window.chrome.webview.postMessage({
            name: answers.name,
            org: answers.org,
            color: answers.color,
            animal: answers.animal,
            prize: lastPrize
        });
    }

    resetAll();
});

document.getElementById("spinAgain").addEventListener("click", () => {
    prizeModal.classList.remove("active");

    spinnerWheel.classList.add("hide");
    spinnerWheel2.classList.add("hide");

    document.body.style.background = "#111";
    canvas.style.display = "block";
    const glass = document.querySelector(".frosted-glass");
    glass.classList.remove("hide");

    // Burst particles from center (all particles for round transition)
    burstParticlesFromCenter(false);

    setTimeout(() => {
        round = 2;
        questions = round2Questions;
        qIndex = 0;
        loadQuestion();
    }, 900);
});

function resetAll() {
    prizeModal.classList.remove("active");

    round = 1;
    questions = round1Questions;
    qIndex = 0;

    spinnerWheel.classList.add("hide");
    spinnerWheel2.classList.add("hide");
    rotation = 0;
    rotation2 = 0;
    wheel.style.transition = "none";
    wheel2.style.transition = "none";
    wheel.style.transform = "rotate(0deg)";
    wheel2.style.transform = "rotate(0deg)";

    setTimeout(() => {
        wheel.style.transition = "transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99)";
        wheel2.style.transition = "transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99)";
    }, 50);

    document.body.style.background = "#111";
    canvas.style.display = "block";
    const glass = document.querySelector(".frosted-glass");
    glass.classList.remove("hide");

    // Burst only white particles when starting fresh
    burstParticlesFromCenter(true);

    loadQuestion();
}
</script>
</body>
</html>