<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Survey Options with Particles</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Electrolize&family=Funnel+Display:wght@300..800&display=swap" rel="stylesheet">
    <style>
        html, body {
            margin: 0;
            height: 100%;
            overflow: hidden;
            background-color: #111;
            font-family: "Funnel Display", sans-serif;
        }

        /* Particle canvas behind everything */
        #particleCanvas {
            position: fixed;
            inset: 0;
            z-index: 0;
        }

        .frosted-glass{
            position: relative;
            z-index: 1; /* ABOVE particles */
            height: 600px;
            width: 800px;
            background: radial-gradient(farthest-corner at 37% 0%, #d73f09ff 0%, #d7400952 40%, #ffffff00 58%), 
                        radial-gradient(farthest-corner at 53% 0%, #f7a162ff 0%, #f8a16399 10%, #ffffff00 48%), 
                        linear-gradient(to top, #ffffff10 100%, #ffffff10 100%);
            box-shadow: 0 4px 30px rgb(0, 0, 0);
            backdrop-filter: blur(10.9px);
            -webkit-backdrop-filter: blur(10.9px);
            margin:auto;
            margin-top:100px;
        }

        .frosted-glass h1{
            color: #ffffff30;
            font-family: "Funnel Display", sans-serif;
            font-weight: 900;
            font-size: 1.25rem;
            margin-bottom: 0;
            rotate: -90deg;
            position: absolute;
            top: 40px;
        }
        
        .frosted-glass .welcome-text h2{
            color: white;
            font-family: "Funnel Display", sans-serif;
            font-weight: 300;
            font-size: 3rem;
            margin-top: 0;
            border-left: 1px solid #fff;
            padding-left: 1rem;
            position: absolute;
            left: 70px;
        }

        .frosted-glass .form-label{
            color: white;
            position: absolute;
            top: 250px;
            left: 229px;
            font-family: "Funnel Display", sans-serif;
            font-size: 1rem;
        }

        .frosted-glass .form-label h2{
            font-weight: 100;
        }

        .white-line{
            position: absolute;
            top: 310px;
            left: 229px;
            width: 345px;
            border-bottom: 1px solid white;
        }

        .frosted-glass form{
            position: relative;
        }

        .input-text-box{
            border-radius: 50px;
            background-color: #ffffff09;
            border: 1px solid rgba(255, 255, 255, 0.384);
            color: white;
            position: absolute;
            top: 325px;
            left: 229px;
            padding: 10px;
            width: 325px;
        }

        .input-text-box::placeholder{
            color:white;
        }

        .frosted-glass form .submit-btn{
            color: white;
            background-color: #d73f09;
            position: absolute;
            top: 325px;
            left: 526px;
            padding: 0.12rem;
            border-radius: 0 50px 50px 0;
            border: 1px solid rgba(255, 255, 255, 0.384);
            width: 50px;
            font-size: 1.5rem;
            cursor: pointer;
        }

        .hide {
            display: none !important;
        }

        .wheel-wrapper {
            position: relative;
            width: 400px;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-radius: 50%;
        }

        .spin-button {
            position: absolute;
            width: 70px;
            height: 70px;
            background: #fff;
            border-radius: 50%;
            z-index: 10;
            display: flex;
            justify-content: center;
            align-items: center;
            text-transform: uppercase;
            font-weight: 700;
            font-size: 14px;
            color: #333;
            border: 5px solid #333;
            cursor: pointer;
            user-select: none;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .spin-button:hover:not(.spinning) {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .spin-button:active:not(.spinning) {
            transform: scale(0.95);
        }

        .spin-button.spinning {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .spin-button::before {
            content: '';
            position: absolute;
            top: -35px;
            width: 25px;
            height: 35px;
            background: #333;
            clip-path: polygon(50% 0%, 15% 100%, 85% 100%);
        }

        .wheel {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #333;
            border-radius: 50%;
            overflow: hidden;
            box-shadow: 0 0 0 8px #333, 0 0 0 18px #fff, 0 0 0 22px #333;
            transition: transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
        }

        .wheel-segment {
            position: absolute;
            width: 50%;
            height: 50%;
            transform-origin: bottom right;
            transform: rotate(calc(45deg * var(--i)));
            clip-path: polygon(0 0, 60% 0, 100% 100%, 0 60%);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .wheel-segment span {
            position: relative;
            transform: rotate(45deg);
            color: #fff;
            font-size: 2.5em;
            font-weight: 700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
        }

        #spinnerWheel {
            opacity: 0;
            transition: opacity 0.8s ease;
            position: absolute;
            top: 205px;
            left: 325px;
            z-index: 3;
        }

        #spinnerWheel.show {
            opacity: 1;
        }

        .fade-out {
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-backdrop.active {
            display: flex;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            padding: 50px;
            border-radius: 20px;
            text-align: center;
            max-width: 450px;
            animation: popIn 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .prize-display {
            font-size: 90px;
            font-weight: 700;
            color: #d73f09;
            margin: 30px 0;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.1);
            animation: bounce 0.6s;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        .modal-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .modal-btn {
            padding: 14px 35px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .modal-btn.primary {
            background: #d73f09;
            color: white;
        }

        .modal-btn.primary:hover {
            background: white;
            color:#000;
            border: 1px solid #000;
            transform: translateY(-2px);
        }

        .modal-btn.secondary {
            background: #f0f0f0;
            color: #333;
        }

        .modal-btn.secondary:hover {
            background: #e0e0e0;
            transform: translateY(-2px);
        }

        .flex{
            display:flex;
        }
    </style>
</head>
<body>

<!-- Particle background -->
<canvas id="particleCanvas"></canvas>

<!-- Foreground content -->
<div class="frosted-glass">
    <div class="welcome-text flex">
        <h1>AGU 2025</h1>
        <h2>Oregon State<br>University</h2>
    </div>
    <div class="form-label">
        <h2 id="questionLabel">Enter Your Name</h2>
    </div>

    <div class="white-line"></div>

    <form id="questionForm">
        <input type="text" id="questionInput" placeholder="Type here..." class="input-text-box">
        <button type="submit" class="submit-btn">ðŸ¡ª</button>
    </form>
</div>

<!-- Spinner -->
<div id="spinnerWheel" class="hide">
    <div class="wheel-wrapper">
        <div class="spin-button" id="spinBtn">SPIN</div>
        <div class="wheel" id="wheelElement">
            <div class="wheel-segment" style="--i:1; background:#d73f09;"><span>100</span></div>
            <div class="wheel-segment" style="--i:2; background:#4A773C;"><span>50</span></div>
            <div class="wheel-segment" style="--i:3; background:#003B5C;"><span>25</span></div>
            <div class="wheel-segment" style="--i:4; background:#f7a162;"><span>75</span></div>
            <div class="wheel-segment" style="--i:5; background:#d73f09;"><span>100</span></div>
            <div class="wheel-segment" style="--i:6; background:#0D5257;"><span>50</span></div>
            <div class="wheel-segment" style="--i:7; background:#D3832B;"><span>25</span></div>
            <div class="wheel-segment" style="--i:8; background:#4A773C;"><span>6</span></div>
        </div>
    </div>
</div>

<!-- Prize Modal -->
<div class="modal-backdrop" id="prizeModal">
    <div class="modal-content">
        <h2>Congratulations!</h2>
        <div class="prize-display" id="prizeValue">100</div>
        <p>You won <strong id="prizeLabel">100 points</strong>!</p>
        <div class="modal-buttons">
            <button class="modal-btn primary" id="spinAgain">Spin Again</button>
            <button class="modal-btn secondary" id="closeModal">Close</button>
        </div>
    </div>
</div>

<script>
/* ------------------------------
   PARTICLE SYSTEM (exact behavior from demo)
------------------------------- */
const canvas = document.getElementById("particleCanvas");
const ctx = canvas.getContext("2d");

let particles = [];
const BASE_PARTICLES = 1000;
let clicked = false;         // same flag behavior as demo
let centerX = window.innerWidth / 2;
let centerY = window.innerHeight / 2;

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    centerX = canvas.width / 2;
    centerY = canvas.height / 2;
}
resize();
window.addEventListener("resize", resize);

function addBaseParticles() {
    particles = [];
    for (let i = 0; i < BASE_PARTICLES; i++) {
        particles.push({
            x: Math.random() * canvas.width,
            y: Math.random() * canvas.height,
            vx: (Math.random() - .5) * .5,
            vy: (Math.random() - .5) * .5,
            size: Math.random()*2 + 1,
            color: "rgba(255,255,255,0.6)" // white-ish on dark bg
        });
    }
}
addBaseParticles();

/* form â†’ extra burst */
function explodeToParticles(x, y) {
    for (let i = 0; i < 25; i++) {
        particles.push({
            x,
            y,
            vx: (Math.random() - .5) * 6,
            vy: (Math.random() - .5) * 6,
            size: Math.random()*4 + 2,
            color: "#d73f09"
        });
    }
}

/* animation loop (same logic as demo file) */
function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    particles.forEach(p => {
        if (!clicked) {
            // drifting
            p.x += p.vx;
            p.y += p.vy;

            if (p.x < 0 || p.x > canvas.width) p.vx *= -1;
            if (p.y < 0 || p.y > canvas.height) p.vy *= -1;
        } else {
            // collapse to center then bounce
            let dx = centerX - p.x;
            let dy = centerY - p.y;

            p.x += dx * 0.07;
            p.y += dy * 0.07;

            // once near center, push outward
            if (Math.abs(dx) < 12 && Math.abs(dy) < 12) {
                p.vx = (Math.random() - 0.5) * 6;
                p.vy = (Math.random() - 0.5) * 6;
            }
        }

        ctx.fillStyle = p.color;
        ctx.beginPath();
        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        ctx.fill();
    });

    requestAnimationFrame(animate);
}
animate();

/* ------------------------------
    QUESTION FLOW (2 rounds, 2 questions each)
------------------------------- */

let round = 1;

const round1Questions = [
    { label: "Enter your name", placeholder: "Name" },
    { label: "Organization", placeholder: "Organization" }
];

const round2Questions = [
    { label: "Favorite Color", placeholder: "Favorite color" },
    { label: "Favorite Animal", placeholder: "Favorite animal" }
];

let questions = round1Questions;
let qIndex = 0;

const questionLabel = document.getElementById("questionLabel");
const questionInput = document.getElementById("questionInput");
const questionForm = document.getElementById("questionForm");

function loadQuestion() {
    const q = questions[qIndex];
    questionLabel.textContent = q.label;
    questionInput.placeholder = q.placeholder;
    questionInput.value = "";
    questionInput.focus();
}

questionForm.addEventListener("submit", (e) => {
    e.preventDefault();

    const value = questionInput.value.trim();
    if (!value) return;

    // burst from form
    const rect = questionForm.getBoundingClientRect();
    explodeToParticles(rect.left + rect.width / 2, rect.top + rect.height / 2);

    qIndex++;

    if (qIndex < questions.length) {
        loadQuestion();
        return;
    }

    // finished this round â†’ go to spinner
    finishedQuestions();
});

function finishedQuestions() {
    const glass = document.querySelector(".frosted-glass");

    // mimic demo: kick particle effect ON as we transition away
    clicked = true;

    setTimeout(() => {
        // hide frosted UI, hide canvas, go to black bg + spinner
        glass.classList.add("hide");
        canvas.style.display = "none";
        document.body.style.background = "black";

        const spinner = document.getElementById("spinnerWheel");
        spinner.classList.remove("hide");
        setTimeout(() => spinner.classList.add("show"), 50);
    }, 300);
}

loadQuestion();

/* ------------------------------
    SPINNER LOGIC
------------------------------- */

const wheel = document.getElementById("wheelElement");
const spinBtn = document.getElementById("spinBtn");
let rotation = 0;
let isSpinning = false;
let prizes = [100, 50, 25, 75, 100, 50, 25, 6];

spinBtn.addEventListener("click", () => {
    if (isSpinning) return;
    isSpinning = true;
    spinBtn.classList.add("spinning");

    const spins = 5 + Math.floor(Math.random() * 3);
    const extra = Math.floor(Math.random() * 360);
    const total = (spins * 360) + extra;

    rotation += total;
    wheel.style.transform = `rotate(${rotation}deg)`;

    setTimeout(() => {
        const normalized = rotation % 360;
        const angle = (360 - normalized + 22.5) % 360;
        const segment = Math.floor(angle / 45);
        const prize = prizes[segment];

        showPrizeModal(prize);
        isSpinning = false;
        spinBtn.classList.remove("spinning");
    }, 5000);
});

/* ------------------------------
    MODAL + ROUND TRANSITIONS
------------------------------- */

function showPrizeModal(prize) {
    document.getElementById("prizeValue").textContent = prize;
    document.getElementById("prizeLabel").textContent = `${prize} points`;

    // ROUND 1 â†’ show Spin Again + Close
    if (round === 1) {
        document.getElementById("spinAgain").style.display = "inline-block";
    }

    // ROUND 2 â†’ only Close
    if (round === 2) {
        document.getElementById("spinAgain").style.display = "none";
    }

    document.getElementById("prizeModal").classList.add("active");
}

const prizeModal = document.getElementById("prizeModal");
const spinnerWheel = document.getElementById("spinnerWheel");

document.getElementById("closeModal").addEventListener("click", () => {
    // if we are in round 1 and they close, treat as full reset
    // if we are in round 2, also reset for next person
    resetAll();
});

document.getElementById("spinAgain").addEventListener("click", () => {
    // exactly like "tryAgain" in demo:
    // - particles do the collapse/explode move
    // - then we return to the form with round 2 questions
    prizeModal.classList.remove("active");

    // show form again
    spinnerWheel.classList.add("hide");
    document.body.style.background = "#111";
    canvas.style.display = "block";
    const glass = document.querySelector(".frosted-glass");
    glass.classList.remove("hide");

    // copy demo pattern: clicked = true, then back to false after a bit
    clicked = true;

    setTimeout(() => {
        // prepare ROUND 2 questions
        clicked = false;
        round = 2;
        questions = round2Questions;
        qIndex = 0;
        loadQuestion();
    }, 900);
});

function resetAll() {
    // hide modal
    prizeModal.classList.remove("active");

    // reset rounds
    round = 1;
    questions = round1Questions;
    qIndex = 0;

    // reset spinner
    spinnerWheel.classList.add("hide");
    rotation = 0;
    wheel.style.transition = "none";
    wheel.style.transform = "rotate(0deg)";
    setTimeout(() => {
        wheel.style.transition = "transform 5s cubic-bezier(0.17, 0.67, 0.12, 0.99)";
    }, 50);

    // restore background + particles + frosted glass
    document.body.style.background = "#111";
    canvas.style.display = "block";
    const glass = document.querySelector(".frosted-glass");
    glass.classList.remove("hide");

    // re-seed particles and reset clicked like fresh page
    clicked = false;
    addBaseParticles();

    loadQuestion();
}
</script>
</body>
</html>
